HOW THE KALSHI WEATHER SCANNER WORKS
=====================================

WHAT THIS TOOL DOES
-------------------
This scanner looks at Kalshi temperature prediction markets and tries to find
bets where the odds are in your favor. Specifically, it looks for "NO" bets
on temperature brackets where the market is pricing the NO side between 88
and 95 cents (out of 100). A NO bet at 92 cents means you pay 92 cents and
win $1 if the temperature does NOT hit the bracket -- a small profit, but one
that hits frequently if the weather cooperates.


THE PIPELINE (STEP BY STEP)
----------------------------
1. SCANNER - Connects to the Kalshi API and pulls all open temperature markets
   (high temp and low temp for ~24 US cities). For each market, it grabs the
   live orderbook (who is willing to buy/sell at what price). It keeps any
   bracket where the best available NO price is between 88 and 95 cents.

2. STATION LOOKUP - Maps each city (e.g. "Chicago") to an official NWS weather
   station code (e.g. "KMDW" = Midway Airport). This is needed to pull real
   weather data.

3. WEATHER DATA - Fetches two things from the National Weather Service:
   a) The current temperature observation at the station right now.
   b) The hourly forecast for the next 24 hours, including predicted high/low.

4. MODELER - This is the brain. It takes the bracket definition (e.g. "50F or
   above"), the current temperature, and the forecast, then computes the
   probability that the bracket will or won't be hit. It uses a normal
   distribution (bell curve) centered on the forecast high/low, with a spread
   based on typical forecast error. It also checks:
   - "Knife-edge risk": Is the forecast temperature very close to the bracket
     boundary? If so, it's a coin flip and risky.
   - "Lock-in": Has the temperature already passed the bracket threshold with
     little time left for it to change? If so, the outcome is nearly certain.

5. ACCOUNTANT - Takes the model's probability and computes whether the bet
   actually makes money after Kalshi's fees (7% taker fee, 1.75% maker fee).
   It calculates:
   - Expected Value (EV): How many cents you expect to profit per contract.
   - Max buy price: The highest price you could pay for NO and still have
     positive expected value.
   - Edge: How much better your model's probability is vs what the market
     implies.

6. PLANNER - Looks at the orderbook depth (how many contracts are available)
   and computes a recommended limit price. It generates step-by-step manual
   order instructions (this system never places trades automatically).

7. RISK MANAGER - Groups markets by geographic region (e.g. "Great Lakes" for
   Chicago/Detroit/Minneapolis) and metro area (e.g. "NYC Metro"). It caps
   how many bets you can have in one region (max 3) or metro (max 2) to
   avoid being overexposed to one weather pattern. It also flags specific
   risks like thin liquidity or wide spreads.

8. MERGE & BUCKET - Combines all the above into one unified view per market,
   then sorts each candidate into a bucket:
   - PRIMARY: Best bets. NO ask is 90-93c, bid room >= 2c, positive EV.
   - TIGHT: Decent but thin. NO ask 90-93c but bid room < 2c.
   - NEAR-MISS: On the watchlist. NO ask 88-89c or 94-95c.
   - REJECTED: Failed one or more checks (see below).

9. ORCHESTRATOR - Compares this run's results with the previous run's results
   and applies stability rules (don't flip-flop a pick between buckets unless
   the change is significant). Saves everything to files and generates the
   report that gets emailed to you.


WHAT THE REJECTED SUMMARY MEANS
---------------------------------
When a candidate shows up in the REJECTED section, it means it passed the
initial price screen (NO ask between 88-95c) but failed a deeper check.
Here's what each rejection reason means:

"EV reject: Negative EV at recommended limit XXc: EV=-YYc"
   The model ran the numbers and determined that at the price you'd have to
   pay (the recommended limit), you would LOSE money on average. The EV
   number tells you how many cents per contract you'd lose. For example,
   "EV=-45.0c" means you'd lose about 45 cents per contract on average.
   This usually happens when the model thinks the probability of NO winning
   is lower than what the market price implies -- meaning the market is
   already pricing it correctly or better than your edge.

"Spread reject: Spread XXc exceeds limit (6c) without qualifying for exception"
   The gap between the best bid and the best ask is too wide. A spread of
   10 cents means there's a 10-cent gap between what buyers want to pay and
   what sellers want to accept. Wide spreads mean you'll overpay getting in
   or lose money getting out. The system rejects anything with a spread
   over 6 cents. This usually indicates a thinly-traded market where it's
   hard to get a fair price.

"Hard reject: No implied NO ask"
   There are no YES bids on the orderbook at all, so there's no way to
   compute what it would cost to buy NO. The market is essentially dead.

"Hard reject: No NO bids"
   Nobody is bidding on the NO side. Even if you bought in, there would be
   no one to sell to if you wanted out.

"Knife-edge reject: HIGH knife-edge risk"
   The forecast temperature is right at the bracket boundary. Example: the
   bracket is "50F or above" and the forecast high is 51F. The outcome is
   basically a coin flip, which means there's no real edge regardless of
   what the price says.

"Correlation cap: Too many picks in [region/metro]"
   You already have enough bets in this geographic area. Adding another
   would overexpose you to one weather system. If a cold front surprises
   Chicago, you don't want 5 bets all riding on the same forecast being
   wrong.

"No trade reason: [reason from accountant]"
   The accountant module flagged a specific reason not to trade, such as
   the model probability being too close to the implied probability (no
   meaningful edge).


WHAT A GOOD DAY LOOKS LIKE
----------------------------
On a good day, you'll see 1-3 PRIMARY picks in the morning report. These
are markets where:
- The NO price is in the sweet spot (90-93 cents)
- The weather forecast strongly supports the NO outcome
- There's enough room between bid and ask to get a fair entry
- The expected value is positive after fees
- The knife-edge risk is low (forecast is well away from the boundary)

On most days, especially at odd hours (like 1 AM when markets are thin),
you'll see all REJECTED. That's normal and correct -- the system is doing
its job by not recommending bad bets.
